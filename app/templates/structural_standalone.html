<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INGEO Structures - ACI 318-25</title>
    <link rel="stylesheet" href="{{ url_for('structural_static', filename='css/structural.css') }}?v=15">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <div class="brand">
                <span class="brand-name">INGEO</span>
                <span class="brand-product">Structures</span>
            </div>
            <nav class="main-nav">
                <button class="nav-tab active" data-page="config-page" title="Configuraci√≥n general del proyecto">
                    <span class="nav-icon">‚öô</span>
                    <span class="nav-label">Config</span>
                </button>
                <button class="nav-tab" data-page="walls-page" title="Dise√±o de muros y columnas">
                    <span class="nav-icon">üß±</span>
                    <span class="nav-label">Muros/Cols</span>
                </button>
                <button class="nav-tab" data-page="beams-page" title="Dise√±o de vigas">
                    <span class="nav-icon">üìè</span>
                    <span class="nav-label">Vigas</span>
                </button>
                <button class="nav-tab" data-page="drop-beams-page" title="Vigas capitel (losas dise√±adas como vigas)">
                    <span class="nav-icon">‚ñ≠</span>
                    <span class="nav-label">V. Capitel</span>
                </button>
            </nav>
            <div class="header-spacer"></div>
            <div class="header-subtitle">ACI 318-25</div>
        </header>

        <!-- ================================================================
             PAGE: CONFIGURACI√ìN GENERAL
             ================================================================ -->
        <div class="page-container" id="config-page">
            <!-- Step 1: Upload -->
            <div class="card" id="upload-section">
                <div class="card-header">1. Cargar archivo Excel de ETABS</div>
                <div class="card-body">
                    <div class="upload-area" id="upload-area">
                        <div class="icon">üìÑ</div>
                        <p>Arrastra tu archivo aqu√≠ o haz clic para seleccionar</p>
                        <p class="hint"><strong>Excel (.xlsx)</strong>: An√°lisis estructural | <strong>E2K (.e2k)</strong>: Generar Section Cuts</p>
                        <img src="{{ url_for('structural_static', filename='img/Tablas_Etabs.png') }}?v=3"
                             alt="Tablas ETABS soportadas"
                             class="etabs-tables-img">
                        <input type="file" id="file-input" accept=".xlsx,.e2k">
                    </div>
                    <div class="loading" id="upload-loading">
                        <div class="spinner"></div>
                        <p id="upload-status">Procesando archivo...</p>
                        <p id="upload-detail" class="upload-detail"></p>
                    </div>
                </div>
            </div>

            <!-- Config card (shown after upload) -->
            <div class="card hidden" id="config-card">
                <div class="card-header">2. Configuraci√≥n del Proyecto</div>
                <div class="card-body">
                    <!-- Materiales -->
                    <div class="config-section">
                        <h4>Materiales de Concreto</h4>
                        <p class="section-hint">Indica el tipo de concreto para cada material. Esto afecta el factor Œª en los c√°lculos de cortante.</p>

                        <div class="table-wrapper" id="materials-table-wrapper">
                            <table class="materials-table" id="materials-table">
                                <thead>
                                    <tr>
                                        <th>Material</th>
                                        <th>f'c (MPa)</th>
                                        <th>Tipo de Concreto</th>
                                        <th title="Factor de modificaci√≥n para concreto ligero (ACI 318-25 ¬ß19.2.4)">Œª</th>
                                        <th>Elementos</th>
                                    </tr>
                                </thead>
                                <tbody id="materials-tbody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Categor√≠a S√≠smica ACI -->
                    <div class="config-section">
                        <h4>Categor√≠a S√≠smica de Dise√±o (SDC)</h4>
                        <p class="section-hint">Define el nivel de detallado s√≠smico seg√∫n ACI 318-25. Afecta œÜv para cortante y requisitos de confinamiento.</p>
                        <div class="control-group">
                            <label for="seismic-category">Categor√≠a:</label>
                            <select id="seismic-category">
                                <option value="SPECIAL" selected>Special (SDC D/E/F) - œÜv=0.60</option>
                                <option value="INTERMEDIATE">Intermediate (SDC C) - œÜv=0.75</option>
                                <option value="ORDINARY">Ordinary (SDC A/B) - œÜv=0.75</option>
                            </select>
                        </div>
                        <p class="section-note">
                            <strong>Special:</strong> Zonas de alta sismicidad. Requisitos completos ¬ß18.10.<br>
                            <strong>Intermediate:</strong> Sismicidad moderada. Requisitos ¬ß18.4-18.5.<br>
                            <strong>Ordinary:</strong> Baja sismicidad. Sin requisitos s√≠smicos especiales.
                        </p>
                    </div>

                    <!-- Zona S√≠smica (futuro) -->
                    <div class="config-section disabled-section">
                        <h4>Zona S√≠smica <span class="coming-soon">(pr√≥ximamente)</span></h4>
                        <p class="section-hint">Configuraci√≥n de zona s√≠smica seg√∫n NCh 433 para c√°lculo de espectro de dise√±o.</p>
                        <div class="disabled-content">
                            <div class="control-group">
                                <label>Zona:</label>
                                <select disabled>
                                    <option>Zona 1</option>
                                    <option>Zona 2</option>
                                    <option>Zona 3</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Tipo de suelo:</label>
                                <select disabled>
                                    <option>A - Roca</option>
                                    <option>B - Suelo muy denso</option>
                                    <option>C - Suelo denso</option>
                                    <option>D - Suelo blando</option>
                                    <option>E - Suelo especial</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="action-bar">
                        <button class="btn btn-secondary" id="new-file-btn">Cargar otro archivo</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================================================================
             PAGE: MUROS Y COLUMNAS
             ================================================================ -->
        <div class="page-container hidden" id="walls-page">

        <!-- Placeholder when no data -->
        <div class="card" id="walls-placeholder">
            <div class="card-body">
                <div class="no-data-placeholder">
                    <p class="no-data-msg">Carga un archivo de ETABS en la pesta√±a <strong>Config</strong> para comenzar.</p>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div class="card hidden" id="results-section">
            <div class="card-header">Muros y Columnas</div>
            <div class="card-body">
                <!-- Stats + Filters -->
                <div class="toolbar-bar">
                    <div class="stats-inline">
                        <span class="stat-item"><strong id="stat-total">0</strong> elementos</span>
                        <span class="stat-item stat-ok"><strong id="stat-ok">0</strong> OK</span>
                        <span class="stat-item stat-fail"><strong id="stat-fail">0</strong> Fail</span>
                        <span class="stat-item"><strong id="stat-rate">0%</strong></span>
                    </div>

                    <!-- Viga de acople (para muros acoplados) -->
                    <div class="standard-beam-config">
                        <span class="beam-label">Viga acople:</span>
                        <select id="std-beam-width" title="Ancho (mm)">
                            <option value="150">150</option>
                            <option value="200" selected>200</option>
                            <option value="250">250</option>
                            <option value="300">300</option>
                        </select>
                        <span>√ó</span>
                        <select id="std-beam-height" title="Alto (mm)">
                            <option value="400">400</option>
                            <option value="500" selected>500</option>
                            <option value="600">600</option>
                            <option value="700">700</option>
                        </select>
                        <span class="beam-separator">|</span>
                        <span>L=</span>
                        <select id="std-beam-ln" title="Largo libre (mm)">
                            <option value="1000">1000</option>
                            <option value="1200">1200</option>
                            <option value="1500" selected>1500</option>
                            <option value="1800">1800</option>
                            <option value="2000">2000</option>
                            <option value="2500">2500</option>
                        </select>
                        <span class="beam-separator">|</span>
                        <select id="std-beam-nbars" title="N¬∫ barras">
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                        <span>œÜ</span>
                        <select id="std-beam-diam" title="Di√°metro barras">
                            <option value="12" selected>12</option>
                            <option value="16">16</option>
                            <option value="18">18</option>
                            <option value="20">20</option>
                            <option value="22">22</option>
                        </select>
                    </div>

                    <div class="toolbar-divider"></div>
                    <button class="btn btn-sm btn-primary" id="generate-report-btn" title="Generar informe PDF">
                        Generar Informe
                    </button>
                </div>

                <!-- Results Table -->
                <div class="table-wrapper">
                    <table class="results-table" id="results-table">
                        <thead>
                            <tr>
                                <th title="Tipo y nombre del elemento">Elemento</th>
                                <th title="Piso">Story</th>
                                <th title="Categor√≠a s√≠smica individual (vac√≠o = usar global)">Cat.</th>
                                <th title="Geometr√≠a: lw √ó espesor, hwcs">Geometr√≠a</th>
                                <th title="Enfierradura distribuida vertical/horizontal">Enfierradura</th>
                                <th title="Elemento de borde">Borde</th>
                                <th title="Viga de acople izquierda">V.Izq</th>
                                <th title="Viga de acople derecha">V.Der</th>
                                <th title="Demand/Capacity ratio - Flexi√≥n">D/C Flex.</th>
                                <th title="Capacidad a flexocompresi√≥n">Flexocompresi√≥n</th>
                                <th title="Demand/Capacity ratio - Corte">D/C Corte</th>
                                <th title="Capacidad al corte">Corte</th>
                                <th title="Propuesta de dise√±o si falla">Propuesta</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="action-bar">
                    <button class="btn btn-secondary" id="new-analysis-btn">Nuevo An√°lisis</button>
                </div>
            </div>
        </div>

        </div><!-- Fin PAGE: Muros y Columnas -->

        <!-- ================================================================
             PAGE: VIGAS
             ================================================================ -->
        <div class="page-container hidden" id="beams-page">

        <!-- Placeholder when no data -->
        <div class="card" id="beams-placeholder">
            <div class="card-body">
                <div class="no-data-placeholder">
                    <p class="no-data-msg">Carga un archivo de ETABS en la pesta√±a <strong>Config</strong> para comenzar.</p>
                </div>
            </div>
        </div>

        <!-- Beams Results (estilo pier - flexocompresi√≥n) -->
        <div class="card hidden" id="beams-results-section">
            <div class="card-header">Vigas</div>
            <div class="card-body">
                <!-- Stats + Filters -->
                <div class="toolbar-bar">
                    <div class="stats-inline">
                        <span class="stat-item"><strong id="beam-stat-total">0</strong> vigas</span>
                        <span class="stat-item stat-ok"><strong id="beam-stat-ok">0</strong> OK</span>
                        <span class="stat-item stat-fail"><strong id="beam-stat-fail">0</strong> Fail</span>
                        <span class="stat-item"><strong id="beam-stat-rate">0%</strong></span>
                    </div>
                    <div class="toolbar-divider"></div>
                    <div class="filter-group">
                        <label>Piso:</label>
                        <select id="beam-story-filter">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="beam-status-filter">
                            <option value="">Todos</option>
                            <option value="OK">OK</option>
                            <option value="FAIL">Fail</option>
                        </select>
                    </div>
                    <button class="btn btn-sm btn-secondary" id="create-custom-beam-btn" title="Crear viga custom">
                        + Crear viga
                    </button>
                </div>

                <!-- Beams Table (usa estructura tipo pier) -->
                <div class="table-wrapper">
                    <table class="results-table pier-results-table" id="beams-table">
                        <thead>
                            <tr>
                                <th title="Viga / Piso">Viga</th>
                                <th title="Ancho √ó Peralte (mm)">Secci√≥n</th>
                                <th title="Luz de la viga">L (m)</th>
                                <th title="Armadura longitudinal superior">Arm. Sup.</th>
                                <th title="Armadura longitudinal inferior">Arm. Inf.</th>
                                <th title="Estribos de confinamiento">Estribos</th>
                                <th title="Demanda/Capacidad Flexi√≥n">D/C Flex.</th>
                                <th title="Capacidad y demanda de flexi√≥n">Flexi√≥n</th>
                                <th title="Demanda/Capacidad Corte">D/C Corte</th>
                                <th title="Capacidad y demanda de corte">Corte</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        </div>

        <!-- ================================================================
             PAGE: VIGAS CAPITEL (Drop Beams)
             ================================================================ -->
        <div class="page-container hidden" id="drop-beams-page">

        <!-- Placeholder when no data -->
        <div class="card" id="drop-beams-placeholder">
            <div class="card-body">
                <div class="no-data-placeholder">
                    <p class="no-data-msg">Carga un archivo de ETABS en la pesta√±a <strong>Config</strong> para comenzar.</p>
                    <p class="hint">Las vigas capitel se extraen de la tabla "Section Cut Forces - Analysis"</p>
                </div>
            </div>
        </div>

        <!-- Drop Beams Results (estilo pier) -->
        <div class="card hidden" id="drop-beams-results-section">
            <div class="card-header">Vigas Capitel</div>
            <div class="card-body">
                <!-- Stats + Filters -->
                <div class="toolbar-bar">
                    <div class="stats-inline">
                        <span class="stat-item"><strong id="drop-beam-stat-total">0</strong> elementos</span>
                        <span class="stat-item stat-ok"><strong id="drop-beam-stat-ok">0</strong> OK</span>
                        <span class="stat-item stat-fail"><strong id="drop-beam-stat-fail">0</strong> Fail</span>
                        <span class="stat-item"><strong id="drop-beam-stat-rate">0%</strong></span>
                    </div>
                    <div class="toolbar-divider"></div>
                    <div class="filter-group">
                        <label>Piso:</label>
                        <select id="drop-beam-story-filter">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="drop-beam-status-filter">
                            <option value="">Todos</option>
                            <option value="OK">OK</option>
                            <option value="FAIL">Fail</option>
                        </select>
                    </div>
                </div>

                <!-- Drop Beams Table (usa ResultsTable estilo pier) -->
                <div class="table-wrapper">
                    <table class="results-table pier-results-table" id="drop-beams-table">
                        <thead>
                            <tr>
                                <th title="Viga capitel / Piso">V. Capitel</th>
                                <th title="Espesor √ó Ancho (mm)">Secci√≥n</th>
                                <th title="Luz libre">L (m)</th>
                                <th title="Armadura vertical malla">Malla V</th>
                                <th title="Armadura horizontal malla">Malla H</th>
                                <th title="Barras de borde">Borde</th>
                                <th title="Demanda/Capacidad Flexi√≥n">D/C Flex.</th>
                                <th title="Capacidad y demanda de flexi√≥n">Flexi√≥n</th>
                                <th title="Demanda/Capacidad Corte">D/C Corte</th>
                                <th title="Capacidad y demanda de corte">Corte</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        </div>

    </div><!-- Fin container -->

    <!-- Modal for PM Diagram with Combination Navigator -->
    <div class="modal" id="plot-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content">
            <div class="modal-layout">
                <!-- Plot Section -->
                <div class="modal-plot-section">
                    <h3 id="modal-pier-title">Diagrama P-M</h3>
                    <div id="modal-plot-loading" class="loading">
                        <div class="spinner"></div>
                        <p>Actualizando diagrama...</p>
                    </div>
                    <img id="modal-plot-img" src="" alt="Diagrama P-M">
                    <div id="modal-combo-info" class="combo-info">
                        <div><strong>Combinaci√≥n:</strong> <span id="modal-combo-name">-</span></div>
                        <div>
                            <strong>P:</strong> <span id="modal-combo-P">-</span> tonf |
                            <strong>M2:</strong> <span id="modal-combo-M2">-</span> tonf-m |
                            <strong>M3:</strong> <span id="modal-combo-M3">-</span> tonf-m
                        </div>
                        <div>
                            <strong>M resultante:</strong> <span id="modal-combo-M">-</span> tonf-m |
                            <strong>Plano:</strong> <span id="modal-combo-angle">-</span>¬∞
                        </div>
                    </div>
                </div>

                <!-- Combination Navigator -->
                <div class="combination-navigator">
                    <h4>Navegar Combinaciones</h4>
                    <p class="nav-hint">Selecciona una combinaci√≥n para ver el diagrama P-M en su plano real.</p>
                    <div class="combo-list" id="modal-combo-list"></div>
                    <div class="combo-nav-controls">
                        <button class="combo-nav-btn" id="combo-prev-btn">‚Üê Anterior</button>
                        <span class="combo-current">
                            <span id="combo-current-index">1</span> / <span id="combo-total">1</span>
                        </span>
                        <button class="combo-nav-btn" id="combo-next-btn">Siguiente ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Pier Details/Capacities (ETABS Style) -->
    <div class="modal" id="pier-details-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content pier-details-etabs">
            <h3 id="pier-details-title">INGEO Shear Wall Design - ACI 318-25</h3>
            <div id="pier-details-loading" class="loading">
                <div class="spinner"></div>
                <p>Cargando datos...</p>
            </div>
            <div id="pier-details-body" class="pier-details-body">

                <!-- Selector de Combinaci√≥n -->
                <div class="combo-selector-section">
                    <label for="pier-combo-selector">Combinaci√≥n de carga:</label>
                    <select id="pier-combo-selector">
                        <option value="-1">Cargando...</option>
                    </select>
                    <span id="combo-critical-badge" class="critical-badge hidden">CR√çTICA</span>
                    <button id="open-pm-diagram-btn" class="action-btn" title="Ver diagrama P-M">üìä</button>
                    <div id="combo-forces-display" class="combo-forces-display">
                        <span>P=<strong id="combo-P">-</strong>t</span>
                        <span>M2=<strong id="combo-M2">-</strong>t-m</span>
                        <span>M3=<strong id="combo-M3">-</strong>t-m</span>
                        <span>V2=<strong id="combo-V2">-</strong>t</span>
                        <span>V3=<strong id="combo-V3">-</strong>t</span>
                    </div>
                </div>

                <!-- Secci√≥n 1: Pier Details -->
                <div class="etabs-section">
                    <h4>Pier Details</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>Story</th>
                                <th>Pier ID</th>
                                <th>Length (m)</th>
                                <th>Thickness (m)</th>
                                <th>Height (m)</th>
                                <th>Ag (m¬≤)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="det-story">-</td>
                                <td id="det-pier">-</td>
                                <td id="det-length">-</td>
                                <td id="det-thickness">-</td>
                                <td id="det-height">-</td>
                                <td id="det-ag">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Secci√≥n 2: Material Properties -->
                <div class="etabs-section">
                    <h4>Material Properties</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>f'c (MPa)</th>
                                <th>fy (MPa)</th>
                                <th>Œª (Lt.Wt)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="det-fc">-</td>
                                <td id="det-fy">-</td>
                                <td id="det-lambda">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Secci√≥n 3: Design Code Parameters -->
                <div class="etabs-section">
                    <h4>Design Code Parameters (ACI 318-25)</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>œÜT</th>
                                <th>œÜC</th>
                                <th>œÜv</th>
                                <th>œÅ_min</th>
                                <th>œÅ_max</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0.90</td>
                                <td>0.65</td>
                                <td id="det-phi-v-param">0.60</td>
                                <td>0.0025</td>
                                <td>0.04</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Secci√≥n 4: Reinforcement -->
                <div class="etabs-section">
                    <h4>Reinforcement</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>Config</th>
                                <th>As vert (mm¬≤)</th>
                                <th>As edge (mm¬≤)</th>
                                <th>As total (mm¬≤)</th>
                                <th>œÅ actual</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="det-reinf-desc">-</td>
                                <td id="det-as-vertical">-</td>
                                <td id="det-as-edge">-</td>
                                <td id="det-as-total">-</td>
                                <td id="det-rho-actual">-</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Contenedor para advertencias de cuant√≠a m√≠nima -->
                    <div id="det-reinf-warnings" class="reinforcement-warnings" style="display: none;"></div>
                </div>

                <!-- Secci√≥n 5: Flexural Design -->
                <div class="etabs-section">
                    <h4>Flexural Design for Pu, Mu2 and Mu3</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>D/C</th>
                                <th>Combo</th>
                                <th>Pu (tonf)</th>
                                <th>Mu2 (tonf-m)</th>
                                <th>Mu3 (tonf-m)</th>
                                <th>œÜMn (tonf-m)</th>
                                <th>c (mm)</th>
                            </tr>
                        </thead>
                        <tbody id="det-flexure-body">
                            <tr>
                                <td colspan="8" class="no-data">Sin datos de carga</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Secci√≥n 6: Shear Design -->
                <div class="etabs-section">
                    <h4>Shear Design <span id="det-phi-v" class="phi-factor">(œÜv = 0.60)</span></h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>Direction</th>
                                <th>D/C</th>
                                <th>Combo</th>
                                <th>Pu (tonf)</th>
                                <th>Mu (tonf-m)</th>
                                <th>Vu (tonf)</th>
                                <th>œÜVc (tonf)</th>
                                <th>œÜVn (tonf)</th>
                            </tr>
                        </thead>
                        <tbody id="det-shear-body">
                            <tr>
                                <td colspan="8" class="no-data">Sin datos de carga</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Secci√≥n 7: Boundary Element Check (solo pier/drop_beam) -->
                <div class="etabs-section" id="boundary-check-section">
                    <h4>Boundary Element Check (ACI 18.10.6.3)</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Combo</th>
                                <th>Pu (tonf)</th>
                                <th>Mu (tonf-m)</th>
                                <th>œÉ_comp (MPa)</th>
                                <th>œÉ_limit (MPa)</th>
                                <th>c (mm)</th>
                                <th>Required?</th>
                            </tr>
                        </thead>
                        <tbody id="det-boundary-body">
                            <tr>
                                <td colspan="8" class="no-data">Sin datos de carga</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Secci√≥n 8: Pure Capacities (oculto para beams sin axial alto) -->
                <div class="etabs-section" id="pure-capacities-section">
                    <h4>Pure Capacities (without interaction)</h4>
                    <table class="etabs-table">
                        <thead>
                            <tr>
                                <th>œÜPn,max (tonf)</th>
                                <th>œÜMn3 (tonf-m)</th>
                                <th>œÜMn2 (tonf-m)</th>
                                <th>œÜVn2 (tonf)</th>
                                <th>œÜVn3 (tonf)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="det-phi-pn">-</td>
                                <td id="det-phi-mn3">-</td>
                                <td id="det-phi-mn2">-</td>
                                <td id="det-phi-vn2">-</td>
                                <td id="det-phi-vn3">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal for Section Diagram -->
    <div class="modal" id="section-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content section-diagram-content">
            <h3 id="section-modal-title">Secci√≥n Transversal</h3>
            <div id="section-modal-loading" class="loading">
                <div class="spinner"></div>
                <p>Generando diagrama...</p>
            </div>
            <img id="section-modal-img" src="" alt="Secci√≥n Transversal">
        </div>
    </div>

    <!-- Modal for Analysis Progress -->
    <div class="progress-modal" id="progress-modal">
        <div class="progress-modal-content">
            <div class="progress-icon">
                <div class="spinner"></div>
            </div>
            <h3 id="progress-text">Procesando pier 0 de 0</h3>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <p class="progress-pier" id="progress-pier">Iniciando...</p>
        </div>
    </div>

    <!-- Modal for Custom Beam Creation -->
    <div class="modal" id="custom-beam-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content custom-beam-content">
            <h3>Crear Viga Custom</h3>
            <form id="custom-beam-form">
                <!-- Basic Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="custom-beam-label">Nombre:</label>
                        <input type="text" id="custom-beam-label" placeholder="VC1" required maxlength="20">
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-story">Piso:</label>
                        <select id="custom-beam-story" required></select>
                    </div>
                </div>

                <!-- Geometry -->
                <h4>Geometr√≠a</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="custom-beam-width">Ancho (mm):</label>
                        <input type="number" id="custom-beam-width" value="200" min="100" max="1000" required>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-depth">Alto (mm):</label>
                        <input type="number" id="custom-beam-depth" value="500" min="200" max="2000" required>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-length">Largo (mm):</label>
                        <input type="number" id="custom-beam-length" value="3000" min="500" max="15000" required>
                    </div>
                </div>

                <!-- Material -->
                <h4>Material</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="custom-beam-fc">f'c (MPa):</label>
                        <input type="number" id="custom-beam-fc" value="28" min="20" max="60" required>
                    </div>
                </div>

                <!-- Longitudinal Reinforcement -->
                <h4>Armadura Longitudinal</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="custom-beam-nbars-top">Barras sup:</label>
                        <select id="custom-beam-nbars-top">
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-diam-top">œÜ sup (mm):</label>
                        <select id="custom-beam-diam-top">
                            <option value="12">12</option>
                            <option value="16" selected>16</option>
                            <option value="18">18</option>
                            <option value="20">20</option>
                            <option value="22">22</option>
                            <option value="25">25</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-nbars-bot">Barras inf:</label>
                        <select id="custom-beam-nbars-bot">
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-diam-bot">œÜ inf (mm):</label>
                        <select id="custom-beam-diam-bot">
                            <option value="12">12</option>
                            <option value="16" selected>16</option>
                            <option value="18">18</option>
                            <option value="20">20</option>
                            <option value="22">22</option>
                            <option value="25">25</option>
                        </select>
                    </div>
                </div>

                <!-- Transverse Reinforcement -->
                <h4>Estribos</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="custom-beam-stirrup-legs">Ramas:</label>
                        <select id="custom-beam-stirrup-legs">
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-stirrup-diam">œÜ (mm):</label>
                        <select id="custom-beam-stirrup-diam">
                            <option value="8">8</option>
                            <option value="10" selected>10</option>
                            <option value="12">12</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="custom-beam-stirrup-spacing">@ (mm):</label>
                        <select id="custom-beam-stirrup-spacing">
                            <option value="100">100</option>
                            <option value="125">125</option>
                            <option value="150" selected>150</option>
                            <option value="175">175</option>
                            <option value="200">200</option>
                            <option value="250">250</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-custom-beam">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Viga</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Report Configuration -->
    <div class="modal" id="report-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content report-config-content">
            <h3>Generar Informe PDF</h3>
            <div class="report-config-form">
                <!-- Project Name -->
                <div class="form-group">
                    <label for="report-project-name">Nombre del Proyecto:</label>
                    <input type="text" id="report-project-name" maxlength="100"
                           placeholder="Mi Proyecto Estructural">
                </div>

                <!-- Top Piers -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="report-top-load">Top piers por carga axial:</label>
                        <input type="number" id="report-top-load" value="5" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label for="report-top-cuantia">Top piers por cuantia:</label>
                        <input type="number" id="report-top-cuantia" value="5" min="1" max="100">
                    </div>
                </div>

                <!-- Include Options -->
                <div class="form-group">
                    <label>Secciones a incluir:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="report-include-failing" checked>
                            Piers que fallan verificacion
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="report-include-proposals" checked>
                            Propuestas de diseno
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="report-include-pm" checked>
                            Diagramas P-M
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="report-include-sections" checked>
                            Secciones transversales
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="report-include-full-table" checked>
                            Tabla completa de resultados
                        </label>
                    </div>
                </div>

                <!-- Validation Error -->
                <div class="form-error" id="report-error" style="display: none;"></div>

                <!-- Actions -->
                <div class="form-actions">
                    <button class="btn btn-secondary" id="report-cancel-btn">Cancelar</button>
                    <button class="btn btn-primary" id="report-generate-btn">
                        <span class="btn-text">Generar PDF</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner-small"></span> Generando...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <!-- Core -->
    <script src="{{ url_for('structural_static', filename='js/core/Constants.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/core/Utils.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/core/StructuralAPI.js') }}?v=1"></script>
    <!-- Modals -->
    <script src="{{ url_for('structural_static', filename='js/modals/ModalUtils.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/modals/PlotModal.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/modals/ReportModal.js') }}?v=1"></script>
    <!-- Editing -->
    <script src="{{ url_for('structural_static', filename='js/editing/RecalcButton.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/editing/ElementEditManager.js') }}?v=1"></script>
    <!-- Filters -->
    <script src="{{ url_for('structural_static', filename='js/filters/ColumnFilters.js') }}?v=1"></script>
    <!-- Tables -->
    <script src="{{ url_for('structural_static', filename='js/tables/FilterableTable.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/cells/SharedCells.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/cells/PierCells.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/cells/ColumnCells.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/cells/BeamCells.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/RowFactory.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/CombinationsManager.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/CouplingBeamManager.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/tables/ResultsTable.js') }}?v=1"></script>
    <!-- Modules -->
    <script src="{{ url_for('structural_static', filename='js/modules/WallsModule.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/modules/BeamsModule.js') }}?v=1"></script>
    <!-- Managers -->
    <script src="{{ url_for('structural_static', filename='js/managers/MaterialsManager.js') }}?v=1"></script>
    <script src="{{ url_for('structural_static', filename='js/managers/UploadManager.js') }}?v=1"></script>
    <!-- Main -->
    <script src="{{ url_for('structural_static', filename='js/StructuralPage.js') }}?v=1"></script>
    <script>
        // Inicializar la p√°gina cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            structuralPage.init();
        });
    </script>
</body>
</html>
