<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INGEO Structures - ACI 318-25</title>
    <link rel="stylesheet" href="{{ url_for('structural_static', filename='css/structural.css') }}">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <div class="brand">
                <span class="brand-name">INGEO</span>
                <span class="brand-product">Structures</span>
            </div>
            <div class="header-divider"></div>
            <div class="header-subtitle">Verificador de Muros ACI 318-25</div>
        </header>

        <!-- Step 1: Upload -->
        <div class="card" id="upload-section">
            <div class="card-header">1. Cargar archivo Excel de ETABS</div>
            <div class="card-body">
                <div class="upload-area" id="upload-area">
                    <div class="icon">üìÑ</div>
                    <p>Arrastra tu archivo Excel aqu√≠ o haz clic para seleccionar</p>
                    <p class="hint">Debe contener las tablas: Pier Section Properties y Pier Forces</p>
                    <input type="file" id="file-input" accept=".xlsx">
                </div>
                <div class="loading" id="upload-loading">
                    <div class="spinner"></div>
                    <p>Procesando archivo...</p>
                </div>
            </div>
        </div>

        <!-- Step 2: Review Piers -->
        <div class="card hidden" id="piers-section">
            <div class="card-header">2. Revisar Piers y Armaduras</div>
            <div class="card-body">
                <p class="section-info">
                    Se encontraron <strong id="pier-count">0</strong> piers.
                    Por defecto se usa armadura m√≠nima (œÅ = 0.25%) con barras œÜ8.
                </p>

                <!-- Filters for Piers -->
                <div class="filters-bar" id="piers-filters">
                    <div class="filter-group">
                        <label>Filtrar por Piso:</label>
                        <select id="piers-story-filter">
                            <option value="">Todos los pisos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Filtrar por Eje:</label>
                        <select id="piers-axis-filter">
                            <option value="">Todos los ejes</option>
                        </select>
                    </div>
                </div>

                <!-- Global Reinforcement Config -->
                <div class="global-config">
                    <h4>Configuraci√≥n Global de Armadura</h4>
                    <div class="config-controls">
                        <div class="control-group">
                            <label>Mallas:</label>
                            <select id="global-meshes">
                                <option value="1">1 (central)</option>
                                <option value="2" selected>2 (doble cara)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Di√°metro:</label>
                            <select id="global-diameter">
                                <option value="6">œÜ6</option>
                                <option value="8" selected>œÜ8</option>
                                <option value="10">œÜ10</option>
                                <option value="12">œÜ12</option>
                                <option value="16">œÜ16</option>
                                <option value="20">œÜ20</option>
                                <option value="22">œÜ22</option>
                                <option value="25">œÜ25</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Espaciamiento:</label>
                            <select id="global-spacing">
                                <option value="100">@100</option>
                                <option value="150">@150</option>
                                <option value="200" selected>@200</option>
                                <option value="250">@250</option>
                                <option value="300">@300</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>œÜ Borde:</label>
                            <select id="global-edge-diameter">
                                <option value="10" selected>œÜ10</option>
                                <option value="12">œÜ12</option>
                                <option value="16">œÜ16</option>
                                <option value="20">œÜ20</option>
                                <option value="22">œÜ22</option>
                                <option value="25">œÜ25</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Recub. (mm):</label>
                            <select id="global-cover">
                                <option value="20">20</option>
                                <option value="25" selected>25</option>
                                <option value="30">30</option>
                                <option value="40">40</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary btn-sm" id="apply-global-btn">Aplicar a todos</button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="pier-edit-table" id="piers-table">
                        <thead>
                            <tr>
                                <th>Piso</th>
                                <th>Pier</th>
                                <th>Largo (m)</th>
                                <th>Espesor (m)</th>
                                <th>f'c (MPa)</th>
                                <th>Mallas</th>
                                <th>œÜ Vert</th>
                                <th>@ Vert</th>
                                <th>œÜ Horiz</th>
                                <th>@ Horiz</th>
                                <th>œÜ Borde</th>
                                <th title="Recubrimiento (mm)">Rec.</th>
                                <th>As (mm¬≤/m)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="action-bar">
                    <button class="btn btn-secondary" id="new-file-btn">Cargar otro archivo</button>
                </div>
            </div>
        </div>

        <!-- Step 3: Results -->
        <div class="card hidden" id="results-section">
            <div class="card-header">3. Resultados del An√°lisis</div>
            <div class="card-body">
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total Piers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value stat-ok" id="stat-ok">0</div>
                        <div class="stat-label">OK</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value stat-fail" id="stat-fail">0</div>
                        <div class="stat-label">NO OK</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-rate">0%</div>
                        <div class="stat-label">Tasa de Aprobaci√≥n</div>
                    </div>
                </div>

                <!-- Filters (cerca de la tabla) -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Filtrar por Piso:</label>
                        <select id="story-filter">
                            <option value="">Todos los pisos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Filtrar por Eje:</label>
                        <select id="axis-filter">
                            <option value="">Todos los ejes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-sm" id="toggle-all-combos-btn" title="Expandir/Colapsar todas las combinaciones">
                            <span id="toggle-combos-icon">‚ñ∂</span> Expandir todo
                        </button>
                    </div>
                    <div class="plane-indicator">
                        <span>Plano actual: </span>
                        <span id="current-plane-label">M3</span>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="table-wrapper">
                    <table class="results-table" id="results-table">
                        <thead>
                            <tr>
                                <th>Piso</th>
                                <th>Pier</th>
                                <th>Dim.</th>
                                <th title="Altura desde secci√≥n cr√≠tica (continuidad del muro)">hwcs</th>
                                <th>Armadura</th>
                                <th>FS Flex.</th>
                                <th>Cap. Flexi√≥n</th>
                                <th>FS Corte</th>
                                <th>Cap. Corte</th>
                                <th>Estado</th>
                                <th title="Propuesta de dise√±o si falla">Propuesta</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <!-- Summary Plot (below table) -->
                <div class="summary-plot" id="summary-plot-container"></div>

                <div class="action-bar">
                    <button class="btn btn-secondary" id="new-analysis-btn">Nuevo An√°lisis</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for PM Diagram with Combination Navigator -->
    <div class="modal" id="plot-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content">
            <div class="modal-layout">
                <!-- Plot Section -->
                <div class="modal-plot-section">
                    <h3 id="modal-pier-title">Diagrama P-M</h3>
                    <div id="modal-plot-loading" class="loading">
                        <div class="spinner"></div>
                        <p>Actualizando diagrama...</p>
                    </div>
                    <img id="modal-plot-img" src="" alt="Diagrama P-M">
                    <div id="modal-combo-info" class="combo-info">
                        <div><strong>Combinaci√≥n:</strong> <span id="modal-combo-name">-</span></div>
                        <div>
                            <strong>P:</strong> <span id="modal-combo-P">-</span> tonf |
                            <strong>M2:</strong> <span id="modal-combo-M2">-</span> tonf-m |
                            <strong>M3:</strong> <span id="modal-combo-M3">-</span> tonf-m
                        </div>
                        <div>
                            <strong>M resultante:</strong> <span id="modal-combo-M">-</span> tonf-m |
                            <strong>Plano:</strong> <span id="modal-combo-angle">-</span>¬∞
                        </div>
                    </div>
                </div>

                <!-- Combination Navigator -->
                <div class="combination-navigator">
                    <h4>Navegar Combinaciones</h4>
                    <p class="nav-hint">Selecciona una combinaci√≥n para ver el diagrama P-M en su plano real.</p>
                    <div class="combo-list" id="modal-combo-list"></div>
                    <div class="combo-nav-controls">
                        <button class="combo-nav-btn" id="combo-prev-btn">‚Üê Anterior</button>
                        <span class="combo-current">
                            <span id="combo-current-index">1</span> / <span id="combo-total">1</span>
                        </span>
                        <button class="combo-nav-btn" id="combo-next-btn">Siguiente ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Pier Details/Capacities -->
    <div class="modal" id="pier-details-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content pier-details-content">
            <h3 id="pier-details-title">Detalles del Pier</h3>
            <div id="pier-details-loading" class="loading">
                <div class="spinner"></div>
                <p>Cargando datos...</p>
            </div>
            <div id="pier-details-body" class="pier-details-body">
                <!-- Informaci√≥n Geom√©trica -->
                <div class="details-section">
                    <h4>Geometr√≠a</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Largo (lw)</span>
                            <span class="detail-value" id="detail-width">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Espesor (tw)</span>
                            <span class="detail-value" id="detail-thickness">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Altura (hw)</span>
                            <span class="detail-value" id="detail-height">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">f'c</span>
                            <span class="detail-value" id="detail-fc">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">fy</span>
                            <span class="detail-value" id="detail-fy">-</span>
                        </div>
                    </div>
                </div>

                <!-- Armadura -->
                <div class="details-section">
                    <h4>Armadura</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Configuraci√≥n</span>
                            <span class="detail-value" id="detail-reinf-desc">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">As vertical</span>
                            <span class="detail-value" id="detail-as-vertical">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">As borde</span>
                            <span class="detail-value" id="detail-as-edge">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">As total flexi√≥n</span>
                            <span class="detail-value" id="detail-as-total">-</span>
                        </div>
                    </div>
                </div>

                <!-- Esbeltez -->
                <div class="details-section" id="slenderness-section">
                    <h4>Esbeltez (ACI 318-25)</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Lambda (k*lu/r)</span>
                            <span class="detail-value" id="detail-lambda">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Limite</span>
                            <span class="detail-value" id="detail-lambda-limit">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Estado</span>
                            <span class="detail-value" id="detail-slender-status">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Reducci√≥n</span>
                            <span class="detail-value" id="detail-slender-reduction">-</span>
                        </div>
                    </div>
                </div>

                <!-- Capacidades -->
                <div class="details-section capacities-section">
                    <h4>Capacidades Puras (sin interacci√≥n)</h4>
                    <div class="capacities-grid">
                        <div class="capacity-item">
                            <span class="capacity-label">Compresi√≥n</span>
                            <span class="capacity-value" id="detail-phi-pn">-</span>
                            <span class="capacity-unit">tonf</span>
                        </div>
                        <div class="capacity-item">
                            <span class="capacity-label">Momento M3</span>
                            <span class="capacity-value" id="detail-phi-mn3">-</span>
                            <span class="capacity-unit">tonf-m</span>
                        </div>
                        <div class="capacity-item">
                            <span class="capacity-label">Momento M2</span>
                            <span class="capacity-value" id="detail-phi-mn2">-</span>
                            <span class="capacity-unit">tonf-m</span>
                        </div>
                        <div class="capacity-item">
                            <span class="capacity-label">Corte V2</span>
                            <span class="capacity-value" id="detail-phi-vn2">-</span>
                            <span class="capacity-unit">tonf</span>
                        </div>
                        <div class="capacity-item">
                            <span class="capacity-label">Corte V3</span>
                            <span class="capacity-value" id="detail-phi-vn3">-</span>
                            <span class="capacity-unit">tonf</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Section Diagram -->
    <div class="modal" id="section-modal">
        <button class="modal-close">√ó</button>
        <div class="modal-content section-diagram-content">
            <h3 id="section-modal-title">Secci√≥n Transversal</h3>
            <div id="section-modal-loading" class="loading">
                <div class="spinner"></div>
                <p>Generando diagrama...</p>
            </div>
            <img id="section-modal-img" src="" alt="Secci√≥n Transversal">
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="{{ url_for('structural_static', filename='js/StructuralAPI.js') }}"></script>
    <script src="{{ url_for('structural_static', filename='js/PlotModal.js') }}"></script>
    <script src="{{ url_for('structural_static', filename='js/PiersTable.js') }}"></script>
    <script src="{{ url_for('structural_static', filename='js/ResultsTable.js') }}"></script>
    <script src="{{ url_for('structural_static', filename='js/StructuralPage.js') }}"></script>
    <script>
        // Inicializar la p√°gina cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            structuralPage.init();
        });
    </script>
</body>
</html>
